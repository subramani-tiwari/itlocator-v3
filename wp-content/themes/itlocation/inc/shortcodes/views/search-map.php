<div class="row-fluid position-relative">	<div id="map-canvas" class="width-100-perc height-600"></div>	<div class="position-absolute map-search-large-loading top-200 left-520">		<img src="<?php echo get_bloginfo('template_url') ?>/images/loading-middle.gif" class="width-50 height-50">	</div>	<div class="position-absolute top-0 right-0">		<div class="visible-desktop">		<?php		$ads = '';		if (get_option('itlocation_ads_txt_map_index')) {			$ads = stripslashes(get_option('itlocation_ads_txt_map_index'));		}		if ($ads) {			_e($ads);		} else {		?>			<div class="position-absolute"><?php _e('Please insert your ads code in Appearance -> Theme Options -> tab "Ads" in admin', 'twentyten'); ?></div>			<img src="http://www.placehold.it/160x600/AFAFAF/fff&text=160x600">		<?php		}		?>		</div>	</div>	<div class="row-fluid search-key-map">		<div class="pull-left txt">			<span><?php _e('The best solutions always come from', 'twentyten') ?></span><br/>			<span class="font-size-28"><?php _e('The local Technology Reseller', 'twentyten') ?></span>		</div>		<div class="pull-left direction-icon"></div>		<div class="pull-left keys">			<form method="post" action="" name="search-map-form" id="search-map-form" enctype="multipart/form-data">				<?php wp_nonce_field('search-map-itlocation', 'search-map-security'); ?>				<?php				echo do_shortcode('[services-ctrl-itlocation kind="services" id="services" class="pull-left width-300" style="" placeholder="Select Services"/]');				echo do_shortcode('[countries-ctrl-itlocation id="countries" add_class="pull-left margin-only-left-20 width-220 margin-only-top-3" style="" selected_option="US"/]');				?>				<div class="clearfix"></div>				<br/>				<input type="text" class="pull-left input-large" name="keywords" id="keywords" placeholder="Keywords" value="">

			<input type="submit" value="<?php _e('Search Now', 'twentyten') ?>" class="pull-left btn btn-primary margin-only-left-10" id="search-map-btn" disabled="disabled" />				<?php				$pid = get_option('itlocation_generals_advanced_search_page');				$tmp_url = get_permalink($pid);				// echo $tmp_url;				?>				<a href="http://www.itlocator.com/advanced-search/?us=1&lo=&co=US&ke=&advanced-search-btn=Search" class="btn btn-success pull-left margin-only-left-10" id="advance-search-map-btn"><?php _e('Advanced Search', 'twentyten') ?></a>			</form>		</div>	</div></div><script language="javascript">function initialize() {	var myOptions = {		zoom: 5,		center: new google.maps.LatLng(37.09024, -95.712891),		mapTypeControl: true,		mapTypeControlOptions: {style: google.maps.MapTypeControlStyle.DROPDOWN_MENU},		navigationControl: true,		mapTypeId: google.maps.MapTypeId.ROADMAP	}	$map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);	jQuery('.map-search-large-loading').hide();	jQuery('#search-map-btn').removeAttr('disabled');   	search_map_init('search-map-form');	// Try HTML5 geolocation	address_itlocation = jQuery.cookie("address_itlocation");	if(address_itlocation == null) {		if (navigator.geolocation) {    			navigator.geolocation.getCurrentPosition(function(position) {				var pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);				var latlong = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);				geocoder = new google.maps.Geocoder();				geocoder.geocode({'latLng': latlong}, function(results, status) {					if (status == google.maps.GeocoderStatus.OK) {						if (results[1]) {							var today = new Date();							today.setTime( today.getTime() );							var expires = 30;							expires = expires * 1000 * 60 * 60 * 24; 							jQuery.cookie("address_pos", position.coords.latitude + "," + position.coords.longitude, {expires: new Date( today.getTime()+expires)});							jQuery.cookie("address_itlocation", results[1].formatted_address, {expires: new Date( today.getTime()+expires)});							jQuery.cookie("first_visit_date", today.getTime(), {expires: 30 });							$str = '<span class="iconic-map-pin font-size-16" style=""></span> <span class="font-size-12 font-weight-bold font-color-393939">' + jQuery.cookie('address_itlocation') + '</span>';														if (jQuery.cookie('address_itlocation'))								jQuery("#location-str").html($str);														new google.maps.InfoWindow({								map: $map,								position: pos							}); 							$map.setCenter(pos);							$map.setZoom(11);							jQuery('#subscriber-itlocation-modal').modal('show');						} else {							alert('No results found');						}					} else {						alert('Geocoder failed due to: ' + status);					}				});			}, function(error) {				switch(error.code) {					case error.PERMISSION_DENIED:					break;					case error.POSITION_UNAVAILABLE:					break;					case error.TIMEOUT:					alert("The request to get user location timed out.");					break;					case error.UNKNOWN_ERROR:					alert("An unknown error occurred.");					break;				}				handleNoGeolocation(true); 			});			} else {			// Browser doesn't support Geolocation			handleNoGeolocation(false);		}	} else {		$str = '<span class="iconic-map-pin font-size-16" style=""></span> <span class="font-size-12 font-weight-bold font-color-393939">' + jQuery.cookie('address_itlocation') + '</span>';		jQuery("#location-str").html($str);		first_date_visit = jQuery.cookie("first_visit_date");		var today = new Date();		var time_diff = today.getTime() - parseFloat(first_date_visit);		time_diff = parseInt(time_diff / (1000 * 60 * 60 *24));		if(time_diff > 3 || time_diff == 3){			jQuery.removeCookie("not_now_subscriber_itlocation");			jQuery.cookie("first_visit_date", today.getTime(), {expires: 30 });			jQuery('#subscriber-itlocation-modal').modal('show');   		}		center = jQuery.cookie("address_pos");		var res = center.split(',');		var pos = new google.maps.LatLng(res[0], res[1]);		$map.setCenter(pos);		$map.setZoom(11);	}  }google.maps.event.addDomListener(window, 'load', initialize);</script><?phpfunction get_index_map_datas() {	$tmp = "SELECT * FROM `company` WHERE (" . $s . " description LIKE '%" . $_REQUEST['keywords'] . "%') ";	$where .= " AND country = 'US'";	$tmp .= $where;	$query = '(SELECT a1.id AS comp_id, a1.user_id AS user_id, a1.companyname AS name, a1.user_role AS user_role, a1.description AS description, a2.lat AS lat, a2.lng AS lng, a1.logo_file_nm AS logo_file_nm FROM (SELECT * FROM (' . $tmp . ') AS a ';	$query .= ') AS a1 INNER JOIN company_address AS a2 ON a1.id = a2.comp_id)';	$query .= ' UNION ';	$query .= '(SELECT a.id AS comp_id, a.user_id AS user_id, a.companyname AS name, a.user_role AS user_role, a.description AS description, a.latitude AS lat, a.longitude AS lng, a.logo_file_nm AS logo_file_nm FROM (' . $tmp . ') AS a ';	$query .= ')';	global $wpdb, $functions_ph;	$tmp_a = $wpdb->get_results($query);	$result_a = array();	$idx = 0;	$upload_dir = wp_upload_dir();	$destination_url = $upload_dir["baseurl"] . "/comp_logo/";	$rating_obj = new commentsMgnItlocation();	$rating_a = $rating_obj->get_info();	if (count($tmp_a)) {		foreach ($tmp_a as $val) {			$user = new WP_User($val->user_id);			if ($user->roles[0] != 'administrator') {				$result_a[$idx]['id'] = $val->user_id;				$result_a[$idx]['user_role'] = $val->user_role;				$result_a[$idx]['name'] = $val->name;								if ($result_a[$idx]['user_role'] != '0')					$result_a[$idx]['description'] = stripslashes(substr($val->description, 0, 300));				$result_a[$idx]['address'] = $val->address;				$result_a[$idx]['x'] = $val->lat;				$result_a[$idx]['y'] = $val->lng;				if ($result_a[$idx]['user_role'] != '0') {					if ($val->logo_file_nm)						$result_a[$idx]['logo_url'] = $destination_url . $val->logo_file_nm;					else						$result_a[$idx]['logo_url'] = 'http://www.placehold.it/70x70/EFEFEF/AAAAAA&text=no+image';				}				$result_a[$idx]['permalink'] = get_author_posts_url($val->user_id);				$edit_fg = $functions_ph->get_default_member_limit('rating', $result_a[$idx]['user_role']);				if ($edit_fg) {					$result_a[$idx]['rating'] = $rating_a[$val->comp_id];				} else {					$result_a[$idx]['rating'] = 'no';					++$idx;				}			}		}	}	return json_encode($result_a);}?>